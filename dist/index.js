function ne(t,e,r){var s=window,o="application/octet-stream",c=r||o,i=t,n=!e&&!r&&i,u=document.createElement("a"),d=function(p){return String(p)},m=s.Blob||s.MozBlob||s.WebKitBlob||d,a=e||"download",l,R;if(m=m.call?m.bind(s):Blob,String(this)==="true"&&(i=[i,c],c=i[0],i=i[1]),n&&n.length<2048&&(a=n.split("/").pop().split("?")[0],u.href=n,u.href.indexOf(n)!==-1)){var P=new XMLHttpRequest;return P.open("GET",n,!0),P.responseType="blob",P.onload=function(p){ne(p.target.response,a,o)},setTimeout(function(){P.send()},0),P}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(i))if(i.length>1024*1024*1.999&&m!==d)i=me(i),c=i.type||o;else return navigator.msSaveBlob?navigator.msSaveBlob(me(i),a):A(i);else if(/([\x80-\xff])/.test(i)){var w=0,v=new Uint8Array(i.length),j=v.length;for(w;w<j;++w)v[w]=i.charCodeAt(w);i=new m([v],{type:c})}l=i instanceof m?i:new m([i],{type:c});function me(p){var k=p.split(/[:;,]/),E=k[1],ae=p.indexOf("charset")>0?3:2,be=k[ae]=="base64"?atob:decodeURIComponent,de=be(k.pop()),fe=de.length,S=0,he=new Uint8Array(fe);for(S;S<fe;++S)he[S]=de.charCodeAt(S);return new m([he],{type:E})}function A(p,k){if("download"in u)return u.href=p,u.setAttribute("download",a),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",u.addEventListener("click",function(ae){ae.stopPropagation(),this.removeEventListener("click",arguments.callee)}),document.body.appendChild(u),setTimeout(function(){u.click(),document.body.removeChild(u),k===!0&&setTimeout(function(){s.URL.revokeObjectURL(u.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(p)&&(p="data:"+p.replace(/^data:([\w\/\-\+]+)/,o)),window.open(p)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=p),!0;var E=document.createElement("iframe");document.body.appendChild(E),!k&&/^data:/.test(p)&&(p="data:"+p.replace(/^data:([\w\/\-\+]+)/,o)),E.src=p,setTimeout(function(){document.body.removeChild(E)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(l,a);if(s.URL)A(s.URL.createObjectURL(l),!0);else{if(typeof l=="string"||l.constructor===d)try{return A("data:"+c+";base64,"+s.btoa(l))}catch{return A("data:"+c+","+encodeURIComponent(l))}R=new FileReader,R.onload=function(p){A(this.result)},R.readAsDataURL(l)}return!0}import{successPromise as $e}from"lkt-control-tools";var V=class{constructor(e){e||(e=""),this.value=e}};var y=class{constructor(e){if(e==="")throw new Error("A resource must have a valid name");this.value=e}};import{fill as Re,toString as ve}from"lkt-string-tools";var f=class{};f.RESOURCE_PARAM_LEFT_SEPARATOR="{",f.RESOURCE_PARAM_RIGHT_SEPARATOR="}",f.debugEnabled=!1;var x=class{constructor(e){e||(e={}),this.value=e}prepareValues(e,r=!1,s={}){typeof e>"u"&&(e={}),typeof s>"u"&&(s={});let o=e,c=Object.keys(this.value),i=r?new window.FormData:{};return c.forEach(n=>{let u=this.value[n].default||null;if(o[n]||u){let m=this.value[n].renameTo||null||n,a=u;typeof o[n]<"u"&&(a=o[n]);let l=this.value[n].type||null;if(l&&a!==null&&typeof a!==void 0)if(l==="string"&&typeof a!="string")a=ve(a);else if(l==="number"&&typeof a!="number")a=Number(a);else{if(l==="boolean"&&typeof a!="boolean")throw new Error(`Param '${n}' must be of type boolean. '${a}' received`);if(l==="array"&&!Array.isArray(a))throw new Error(`Param '${n}' must be a valid array. '${a}' received`);if(l==="object"&&typeof a!="object")throw new Error(`Param '${n}' must be a valid object. '${a}' received`)}r?i.append(m,a):i[m]=a}}),Object.keys(s).forEach(n=>{i[n]||(r?i.append(n,s[n].default):i[n]=s[n].default)}),i}replaceUrlValues(e,r){let s=this.prepareValues(r,!1);return Re(e,s,f.RESOURCE_PARAM_LEFT_SEPARATOR,f.RESOURCE_PARAM_RIGHT_SEPARATOR)}};var O=class{constructor(e,r,s,o,c){this.name=new y(e),this.url=new V(r),this.params=new x(o),this.headers=typeof c>"u"?{}:c,this.auth=s}getParams(){return JSON.parse(JSON.stringify(this.params.value))}};import Se from"axios";import{successPromise as Ve}from"lkt-control-tools";import{trim as ue}from"lkt-string-tools";var h=class h{static hasResource(e){return h.resources[e]instanceof T}static getResource(e){if(h.resources[e]instanceof T)return h.resources[e]}static addResource(e){h.resources[e.name.value]=e}static hasEnvironment(e){return h.environments[e]instanceof T}static getEnvironment(e){if(h.environments[e]instanceof O)return h.environments[e]}static addEnvironment(e){h.environments[e.name.value]=e}};h.resources={},h.environments={default:new O("default","")};var g=h;var ge=t=>{let e=[];return Object.keys(t).forEach(s=>{Array.isArray(t[s])?t[s].length>0&&e.push(`${s}=${JSON.stringify(t[s])}`):e.push(`${s}=${t[s]}`)}),e.join("&")},Te=t=>g.hasResource(t);var C=class{constructor(e){e||(e="json"),this.value=e}isJSON(){return this.value==="json"}};var U=class{constructor(e){e||(e="default"),this.value=e}getUrl(){let e=D(this.value);return e?e.url.value:""}getAuth(){let e=D(this.value);return e&&e.auth?e.auth:{}}getParams(){let e=D(this.value);return e&&e.params?e.getParams():{}}getHeaders(){let e=D(this.value);return e&&e.headers?JSON.parse(JSON.stringify(e.headers)):{}}};var H=class{constructor(e){e||(e=!1),this.value=e}};import{fetchInObject as Pe}from"lkt-object-tools";var M=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Pe(e,this.value)}};var I=class{constructor(e=!1){this.value=e}inProgress(){return this.value}start(){this.value=!0}stop(){this.value=!1}};var F=class{constructor(e){e||(e="get"),this.value=e}toPrimitive(){return this.value.toLowerCase()}isGET(){return this.value==="get"}isPOST(){return this.value==="post"}isPUT(){return this.value==="put"}isDELETE(){return this.value==="delete"}isOPEN(){return this.value==="open"}isDOWNLOAD(){return this.value==="download"}hasUrlParams(){return this.isGET()||this.isOPEN()||this.isDOWNLOAD()}};var N=class{constructor(e){if(e==="")throw new Error("A resource must have a valid url");this.value=e}prepare(e){return e?`${e}${this.value}`:this.value}};var $=class{constructor(e){typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e){return this.value(e)}};var G=class{constructor(e){e||(e=!1),this.value=e}};import{fetchInObject as we}from"lkt-object-tools";var B=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return we(e,this.value)}};var _=class{constructor(e){e||(e=[200,201,202]),this.value=e}includes(e){return this.value.includes(e)}};var q=class{constructor(e,r,s,o,c,i){this.url=e,this.method=r,this.data=s,Object.keys(o).length>0&&(this.auth=o),this.statusValidator=c,this.headers=i}};import{fetchInObject as Oe}from"lkt-object-tools";var J=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Oe(e,this.value)}};import{fetchInObject as De}from"lkt-object-tools";var K=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return De(e,this.value)}};var W=class{constructor(e){typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e,r){return this.value(e,r)}};import{fetchInObject as ke}from"lkt-object-tools";var z=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return ke(e,this.value)}};import{fetchInObject as ye}from"lkt-object-tools";var X=class{constructor(e){e||(e={}),this.value=e}hasToDig(){return Object.keys(this.value).length>0}dig(e){let r={};for(let s in this.value)r[s]=ye(e,this.value[s]);return r}};import{mergeObjects as ce}from"lkt-object-tools";var b=(...t)=>{f.debugEnabled&&console.info("[LktHttpClient] ",...t)},xe=(t=!0)=>{f.debugEnabled=t};var Q=class{constructor(e){e||(e=!1),this.value=e}keepValues(){return this.value}};var Y=class{constructor(e){e||(e=!1),this.value=e}};import{fetchInObject as Le}from"lkt-object-tools";var Z=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Le(e,this.value)}};import{fetchInObject as je}from"lkt-object-tools";var ee=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return je(e,this.value)}};import{fetchInObject as Ae}from"lkt-object-tools";var te=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Ae(e,this.value)}};import{fetchInObject as Ee}from"lkt-object-tools";var re=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Ee(e,this.value)}};var T=class{constructor(e){this.data=e,this.url=new N(e.url),this.name=new y(e.name),this.method=new F(e.method),this.environment=new U(e.environment),this.dataType=new C(e.dataType),this.params=new x(e.params),this.isFileUpload=new H(e.isFileUpload),this.validStatuses=new _(e.validStatuses),this.fetchStatus=new I,this.onSuccess=new $(e.onSuccess),this.mapData=new W(e.mapData),this.returnsFullResponse=new G(e.returnsFullResponse),this.returnsResponseDig=new B(e.digToData),this.maxPageDig=new M(e.digToMaxPage),this.permDig=new J(e.digToPerms),this.modificationsDig=new K(e.digToModifications),this.digToAutoReloadId=new z(e.digToAutoReloadId),this.digToValidationCode=new te(e.digToValidationCode),this.digToValidationMessage=new Z(e.digToValidationMessage),this.digToValidationData=new ee(e.digToValidationData),this.digToRedirect=new re(e.digToRedirect),this.custom=new X(e.custom),this.keepUrlParams=new Q(e.keepUrlParams),this.isFullUrl=new Y(e.isFullUrl)}build(e){b("Build resource",this.name.value,this.url.value,this.method.value),b("Given params",e);let r=this.environment.getParams(),s=ce(r,e),o=this.params.prepareValues(s,this.isFileUpload.value,r);b("Prepared data",o);let c=this.isFullUrl.value?"":this.environment.getUrl(),i=this.url.prepare(c),n=this.params.replaceUrlValues(i,s);if(this.method.hasUrlParams()){if(!this.keepUrlParams.keepValues()){let l=f.RESOURCE_PARAM_LEFT_SEPARATOR,R=f.RESOURCE_PARAM_RIGHT_SEPARATOR,P=new RegExp(`[${l}${R}]`),w=Object.keys(o),v=i.split(P);v=v.filter(j=>w.includes(j)),v.forEach(j=>delete o[j]),b("Remove data from string params",v),b("Final prepared data",o)}let a=ge(o);a.length>0&&(n=[n,a].join("?")),o={}}b("Prepared url",n);let u=a=>this.validStatuses.includes(a),d={},m=this.environment.getHeaders();return d=ce(d,m),this.isFileUpload.value&&(d=ce(d,{"Content-Type":"multipart/form-data"})),b("Prepared headers",d),new q(n,this.method.toPrimitive(),o,this.environment.getAuth(),u,d)}async call(e){let r=this.build(e);if(b("Call resource -> build:",r),this.fetchStatus.inProgress())return Ve(void 0,void 0);let s=Se.create({headers:r.headers});switch(this.fetchStatus.start(),r.method){case"get":return await s.get(r.url,r).then(o=>this.parseResponse(o)).catch(o=>this.parseError(o));case"post":return await s.post(r.url,r.data,r).then(o=>this.parseResponse(o)).catch(o=>this.parseError(o));case"put":return await s.put(r.url,r.data,r).then(o=>this.parseResponse(o)).catch(o=>this.parseError(o));case"delete":return await s.delete(r.url,r).then(o=>this.parseResponse(o)).catch(o=>this.parseError(o));case"download":case"open":return r.responseType="blob",await s.get(r.url,r).then(o=>{this.fetchStatus.stop();let c=o.headers["content-disposition"],i="";c&&c.split(";").forEach(m=>{let a=m.split("=");if(ue(a[0])==="filename"){let l=ue(a[1]);l=ue(l,'"'),i=l}}),window.download(o.data,i);let n=[],u={data:o.data,maxPage:0,perms:n,modifications:{},custom:{},response:o,success:!0,httpStatus:o.status,autoReloadId:0,contentType:"",validationCode:"",validationMessage:"",validationData:{}};return this.onSuccess.hasActionDefined()?this.onSuccess.run(u):u}).catch(o=>this.parseError(o));default:throw new Error(`Error: Invalid method in call ${JSON.stringify(r)}`)}}parseResponse(e){b("Parse response:",e),this.fetchStatus.stop();let r=this.returnsFullResponse.value?e:e.data,s=-1;this.maxPageDig.hasToDig()&&(s=this.maxPageDig.dig(r));let o=[];this.permDig.hasToDig()&&(o=this.permDig.dig(r));let c={};this.custom.hasToDig()&&(c=this.custom.dig(r));let i={};this.modificationsDig.hasToDig()&&(i=this.modificationsDig.dig(r));let n="";this.digToAutoReloadId.hasToDig()&&(n=this.digToAutoReloadId.dig(r));let u="";this.digToValidationMessage.hasToDig()&&(u=this.digToValidationMessage.dig(r));let d="";this.digToValidationCode.hasToDig()&&(d=this.digToValidationCode.dig(r));let m={};this.digToValidationData.hasToDig()&&(m=this.digToValidationData.dig(r)),this.returnsResponseDig.hasToDig()&&(r=this.returnsResponseDig.dig(r)),this.mapData.hasActionDefined()&&(r=this.mapData.run(r,{custom:c}));let a="";this.digToRedirect.hasToDig()&&(a=this.digToRedirect.dig(r)),a&&(window.location.href===a?window.location.reload():window.location.href=a);let l=e.headers["content-type"],R={data:r,maxPage:s,perms:o,modifications:i,custom:c,response:e,success:!0,httpStatus:e.status,autoReloadId:n,contentType:l,validationCode:d,validationMessage:u,validationData:m};return b("Parsed response:",R),this.onSuccess.hasActionDefined()?this.onSuccess.run(R):R}parseError(e){this.fetchStatus.stop();let r=[],s=e.response?.headers["content-type"];return{data:{status:typeof e.response>"u"?500:e.response.status},maxPage:-1,perms:r,modifications:{},custom:{},response:e,success:!1,httpStatus:typeof e.response>"u"?500:e.response.status,autoReloadId:0,contentType:s,validationCode:"",validationMessage:"",validationData:{}}}};var Ce=t=>{let e={...t,method:"get"};return L(e)},Ue=t=>{let e={...t,method:"post"};return L(e)},He=t=>{let e={...t,method:"put"};return L(e)},Me=t=>{let e={...t,method:"delete"};return L(e)},Ie=t=>{let e={...t,method:"open"};return L(e)},Fe=t=>{let e={...t,method:"download"};return L(e)},L=t=>{let e=new T(t);return g.addResource(e),oe(t.name)},Ne=t=>{let e=new O(t.name,t.url,t.auth,t.params,t.headers);return g.addEnvironment(e),D(t.name)},oe=t=>g.getResource(t),D=t=>g.getEnvironment(t);var le=async(t="",e={})=>{let r=typeof t=="object"?t:oe(t);return typeof r<"u"?await r.call(e):{data:{},maxPage:-1,perms:[],modifications:{},response:void 0,success:!1,httpStatus:-1,autoReloadId:-1,custom:{},contentType:"",validationCode:"",validationMessage:"",validationData:{}}};var se=class{constructor(e){e||(e=""),this.value=e}exists(){return g.hasResource(this.value)}async call(e){return await le(this.value,e)}};var ie=class{constructor(e){e||(e={}),this.value=e}setParam(e,r){this.value[e]=r}getParams(){return this.value}};var pe=class{constructor(e){this.resource=new se(e.resource),this.params=new ie(e.params)}isCallable(){return this.resource.exists()}setParam(e,r){this.params.setParam(e,r)}setParams(e){Object.keys(e).forEach(r=>{this.params.setParam(r,e[r])})}async call(){return this.isCallable()?await this.resource.call(this.params.getParams()):await $e(void 0,void 0)}};var Ge={install:(t,e)=>{window.download=ne}},Ir=Ge;export{pe as ResourceCaller,Me as createHTTPDeleteResource,Fe as createHTTPDownloadResource,Ne as createHTTPEnvironment,Ce as createHTTPGetResource,Ie as createHTTPOpenResource,Ue as createHTTPPostResource,He as createHTTPPutResource,xe as debugLktHttpClient,Ir as default,Te as existsHTTPResource,D as getHTTPEnvironment,oe as getHTTPResource,le as httpCall};
