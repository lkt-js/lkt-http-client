function ae(t,e,r){var i=window,o="application/octet-stream",u=r||o,s=t,a=!e&&!r&&s,c=document.createElement("a"),d=function(p){return String(p)},m=i.Blob||i.MozBlob||i.WebKitBlob||d,n=e||"download",l,v;if(m=m.call?m.bind(i):Blob,String(this)==="true"&&(s=[s,u],u=s[0],s=s[1]),a&&a.length<2048&&(n=a.split("/").pop().split("?")[0],c.href=a,c.href.indexOf(a)!==-1)){var P=new XMLHttpRequest;return P.open("GET",a,!0),P.responseType="blob",P.onload=function(p){ae(p.target.response,n,o)},setTimeout(function(){P.send()},0),P}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(s))if(s.length>1024*1024*1.999&&m!==d)s=me(s),u=s.type||o;else return navigator.msSaveBlob?navigator.msSaveBlob(me(s),n):j(s);else if(/([\x80-\xff])/.test(s)){var w=0,R=new Uint8Array(s.length),A=R.length;for(w;w<A;++w)R[w]=s.charCodeAt(w);s=new m([R],{type:u})}l=s instanceof m?s:new m([s],{type:u});function me(p){var k=p.split(/[:;,]/),E=k[1],ne=p.indexOf("charset")>0?3:2,Re=k[ne]=="base64"?atob:decodeURIComponent,de=Re(k.pop()),fe=de.length,S=0,he=new Uint8Array(fe);for(S;S<fe;++S)he[S]=de.charCodeAt(S);return new m([he],{type:E})}function j(p,k){if("download"in c)return c.href=p,c.setAttribute("download",n),c.className="download-js-link",c.innerHTML="downloading...",c.style.display="none",c.addEventListener("click",function(ne){ne.stopPropagation(),this.removeEventListener("click",arguments.callee)}),document.body.appendChild(c),setTimeout(function(){c.click(),document.body.removeChild(c),k===!0&&setTimeout(function(){i.URL.revokeObjectURL(c.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(p)&&(p="data:"+p.replace(/^data:([\w\/\-\+]+)/,o)),window.open(p)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=p),!0;var E=document.createElement("iframe");document.body.appendChild(E),!k&&/^data:/.test(p)&&(p="data:"+p.replace(/^data:([\w\/\-\+]+)/,o)),E.src=p,setTimeout(function(){document.body.removeChild(E)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(l,n);if(i.URL)j(i.URL.createObjectURL(l),!0);else{if(typeof l=="string"||l.constructor===d)try{return j("data:"+u+";base64,"+i.btoa(l))}catch{return j("data:"+u+","+encodeURIComponent(l))}v=new FileReader,v.onload=function(p){j(this.result)},v.readAsDataURL(l)}return!0}import{successPromise as Be}from"lkt-control-tools";var C=class{constructor(e){e||(e=""),this.value=e}};var x=class{constructor(e){if(e==="")throw new Error("A resource must have a valid name");this.value=e}};import{fill as Te,toString as Pe}from"lkt-string-tools";var f=class{};f.RESOURCE_PARAM_LEFT_SEPARATOR="{",f.RESOURCE_PARAM_RIGHT_SEPARATOR="}",f.debugEnabled=!1;var D=class{constructor(e){e||(e={}),this.value=e}prepareValues(e,r=!1,i={}){typeof e>"u"&&(e={}),typeof i>"u"&&(i={});let o=e,u=Object.keys(this.value),s=r?new window.FormData:{};return u.forEach(a=>{let c=this.value[a].default||null;if(o[a]||c){let m=this.value[a].renameTo||null||a,n=c;typeof o[a]<"u"&&(n=o[a]);let l=this.value[a].type||null;if(l&&n!==null&&typeof n!==void 0)if(l==="string"&&typeof n!="string")n=Pe(n);else if(l==="number"&&typeof n!="number")n=Number(n);else{if(l==="boolean"&&typeof n!="boolean")throw new Error(`Param '${a}' must be of type boolean. '${n}' received`);if(l==="array"&&!Array.isArray(n))throw new Error(`Param '${a}' must be a valid array. '${n}' received`);if(l==="object"&&typeof n!="object")throw new Error(`Param '${a}' must be a valid object. '${n}' received`)}r?s.append(m,n):s[m]=n}}),Object.keys(i).forEach(a=>{s[a]||(r?s.append(a,i[a].default):s[a]=i[a].default)}),s}replaceUrlValues(e,r){let i=this.prepareValues(r,!1);return Te(e,i,f.RESOURCE_PARAM_LEFT_SEPARATOR,f.RESOURCE_PARAM_RIGHT_SEPARATOR)}};var O=class{constructor(e,r,i,o,u){this.name=new x(e),this.url=new C(r),this.params=new D(o),this.headers=typeof u>"u"?{}:u,this.auth=i}getParams(){return JSON.parse(JSON.stringify(this.params.value))}};import Ve from"axios";import{successPromise as He}from"lkt-control-tools";import{trim as ue}from"lkt-string-tools";var h=class h{static hasResource(e){return h.resources[e]instanceof T}static getResource(e){if(h.resources[e]instanceof T)return h.resources[e]}static addResource(e){h.resources[e.name.value]=e}static hasEnvironment(e){return h.environments[e]instanceof T}static getEnvironment(e){if(h.environments[e]instanceof O)return h.environments[e]}static addEnvironment(e){h.environments[e.name.value]=e}};h.resources={},h.environments={default:new O("default","")};var g=h;var ge=t=>{let e=[];return Object.keys(t).forEach(i=>{Array.isArray(t[i])?t[i].length>0&&e.push(`${i}=${JSON.stringify(t[i])}`):e.push(`${i}=${t[i]}`)}),e.join("&")},we=t=>g.hasResource(t);var V=class{constructor(e){e||(e="json"),this.value=e}isJSON(){return this.value==="json"}};var H=class{constructor(e){e||(e="default"),this.value=e}getUrl(){let e=y(this.value);return e?e.url.value:""}getAuth(){let e=y(this.value);return e&&e.auth?e.auth:{}}getParams(){let e=y(this.value);return e&&e.params?e.getParams():{}}getHeaders(){let e=y(this.value);return e&&e.headers?JSON.parse(JSON.stringify(e.headers)):{}}};var U=class{constructor(e){e||(e=!1),this.value=e}};import{fetchInObject as Oe}from"lkt-object-tools";var M=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Oe(e,this.value)}};var I=class{constructor(e=!1){this.value=e}inProgress(){return this.value}start(){this.value=!0}stop(){this.value=!1}};var be=(s=>(s.Get="get",s.Post="post",s.Put="put",s.Delete="delete",s.Open="open",s.Download="download",s))(be||{});var F=class{constructor(e){e||(e="get"),this.value=e}toPrimitive(){return this.value.toLowerCase()}isGET(){return this.value==="get"}isPOST(){return this.value==="post"}isPUT(){return this.value==="put"}isDELETE(){return this.value==="delete"}isOPEN(){return this.value==="open"}isDOWNLOAD(){return this.value==="download"}hasUrlParams(){return this.isGET()||this.isOPEN()||this.isDOWNLOAD()}};var N=class{constructor(e){if(e==="")throw new Error("A resource must have a valid url");this.value=e}prepare(e){return e?`${e}${this.value}`:this.value}};var $=class{constructor(e){typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e){return this.value(e)}};var G=class{constructor(e){e||(e=!1),this.value=e}};import{fetchInObject as ye}from"lkt-object-tools";var B=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return ye(e,this.value)}};var _=class{constructor(e){e||(e=[200,201,202]),this.value=e}includes(e){return this.value.includes(e)}};var q=class{constructor(e,r,i,o,u,s){this.url=e,this.method=r,this.data=i,Object.keys(o).length>0&&(this.auth=o),this.statusValidator=u,this.headers=s}};import{fetchInObject as ke}from"lkt-object-tools";var J=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return ke(e,this.value)}};import{fetchInObject as xe}from"lkt-object-tools";var K=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return xe(e,this.value)}};var W=class{constructor(e){typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e,r){return this.value(e,r)}};import{fetchInObject as De}from"lkt-object-tools";var z=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return De(e,this.value)}};import{fetchInObject as Le}from"lkt-object-tools";var X=class{constructor(e){e||(e={}),this.value=e}hasToDig(){return Object.keys(this.value).length>0}dig(e){let r={};for(let i in this.value)r[i]=Le(e,this.value[i]);return r}};import{mergeObjects as ce}from"lkt-object-tools";var b=(...t)=>{f.debugEnabled&&console.info("[LktHttpClient] ",...t)},Ae=(t=!0)=>{f.debugEnabled=t};var Q=class{constructor(e){e||(e=!1),this.value=e}keepValues(){return this.value}};var Y=class{constructor(e){e||(e=!1),this.value=e}};import{fetchInObject as je}from"lkt-object-tools";var Z=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return je(e,this.value)}};import{fetchInObject as Ee}from"lkt-object-tools";var ee=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Ee(e,this.value)}};import{fetchInObject as Se}from"lkt-object-tools";var te=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Se(e,this.value)}};import{fetchInObject as Ce}from"lkt-object-tools";var re=class{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return Ce(e,this.value)}};var ve=(r=>(r.Auto="auto",r.OverrideData="override-data",r))(ve||{});var T=class{constructor(e){this.modificationHandleType="auto";this.data=e,this.url=new N(e.url),this.name=new x(e.name),this.method=new F(e.method),this.environment=new H(e.environment),this.dataType=new V(e.dataType),this.params=new D(e.params),this.isFileUpload=new U(e.isFileUpload),this.validStatuses=new _(e.validStatuses),this.fetchStatus=new I,this.onSuccess=new $(e.onSuccess),this.mapData=new W(e.mapData),this.returnsFullResponse=new G(e.returnsFullResponse),this.returnsResponseDig=new B(e.digToData),this.maxPageDig=new M(e.digToMaxPage),this.permDig=new J(e.digToPerms),this.modificationsDig=new K(e.digToModifications),this.digToAutoReloadId=new z(e.digToAutoReloadId),this.digToValidationCode=new te(e.digToValidationCode),this.digToValidationMessage=new Z(e.digToValidationMessage),this.digToValidationData=new ee(e.digToValidationData),this.digToRedirect=new re(e.digToRedirect),this.custom=new X(e.custom),this.keepUrlParams=new Q(e.keepUrlParams),this.isFullUrl=new Y(e.isFullUrl),e.modificationHandleType&&(this.modificationHandleType=e.modificationHandleType)}build(e){b("Build resource",this.name.value,this.url.value,this.method.value),b("Given params",e);let r=this.environment.getParams(),i=ce(r,e),o=this.params.prepareValues(i,this.isFileUpload.value,r);b("Prepared data",o);let u=this.isFullUrl.value?"":this.environment.getUrl(),s=this.url.prepare(u),a=this.params.replaceUrlValues(s,i);if(this.method.hasUrlParams()){if(!this.keepUrlParams.keepValues()){let l=f.RESOURCE_PARAM_LEFT_SEPARATOR,v=f.RESOURCE_PARAM_RIGHT_SEPARATOR,P=new RegExp(`[${l}${v}]`),w=Object.keys(o),R=s.split(P);R=R.filter(A=>w.includes(A)),R.forEach(A=>delete o[A]),b("Remove data from string params",R),b("Final prepared data",o)}let n=ge(o);n.length>0&&(a=[a,n].join("?")),o={}}b("Prepared url",a);let c=n=>this.validStatuses.includes(n),d={},m=this.environment.getHeaders();return d=ce(d,m),this.isFileUpload.value&&(d=ce(d,{"Content-Type":"multipart/form-data"})),b("Prepared headers",d),new q(a,this.method.toPrimitive(),o,this.environment.getAuth(),c,d)}async call(e){let r=this.build(e);if(b("Call resource -> build:",r),this.fetchStatus.inProgress())return He(void 0,void 0);let i=Ve.create({headers:r.headers});switch(this.fetchStatus.start(),r.method){case"get":return await i.get(r.url,r).then(o=>this.parseResponse(o)).catch(o=>this.parseError(o));case"post":return await i.post(r.url,r.data,r).then(o=>this.parseResponse(o)).catch(o=>this.parseError(o));case"put":return await i.put(r.url,r.data,r).then(o=>this.parseResponse(o)).catch(o=>this.parseError(o));case"delete":return await i.delete(r.url,r).then(o=>this.parseResponse(o)).catch(o=>this.parseError(o));case"download":case"open":return r.responseType="blob",await i.get(r.url,r).then(o=>{this.fetchStatus.stop();let u=o.headers["content-disposition"],s="";u&&u.split(";").forEach(m=>{let n=m.split("=");if(ue(n[0])==="filename"){let l=ue(n[1]);l=ue(l,'"'),s=l}}),window.download(o.data,s);let a=[],c={data:o.data,maxPage:0,perms:a,modifications:{},custom:{},response:o,success:!0,httpStatus:o.status,autoReloadId:0,contentType:"",validationCode:"",validationMessage:"",validationData:{}};return this.onSuccess.hasActionDefined()?this.onSuccess.run(c):c}).catch(o=>this.parseError(o));default:throw new Error(`Error: Invalid method in call ${JSON.stringify(r)}`)}}parseResponse(e){b("Parse response:",e),this.fetchStatus.stop();let r=this.returnsFullResponse.value?e:e.data,i=-1;this.maxPageDig.hasToDig()&&(i=this.maxPageDig.dig(r));let o=[];this.permDig.hasToDig()&&(o=this.permDig.dig(r));let u={};this.custom.hasToDig()&&(u=this.custom.dig(r));let s={};this.modificationsDig.hasToDig()&&(s=this.modificationsDig.dig(r));let a="";this.digToAutoReloadId.hasToDig()&&(a=this.digToAutoReloadId.dig(r));let c="";this.digToValidationMessage.hasToDig()&&(c=this.digToValidationMessage.dig(r));let d="";this.digToValidationCode.hasToDig()&&(d=this.digToValidationCode.dig(r));let m={};switch(this.digToValidationData.hasToDig()&&(m=this.digToValidationData.dig(r)),this.returnsResponseDig.hasToDig()&&(r=this.returnsResponseDig.dig(r)),this.mapData.hasActionDefined()&&(r=this.mapData.run(r,{custom:u}),Object.keys(s).length>0&&(s=this.mapData.run(s,{custom:u}))),this.modificationHandleType){case"override-data":r=s;break}let n="";this.digToRedirect.hasToDig()&&(n=this.digToRedirect.dig(r)),n&&(window.location.href===n?window.location.reload():window.location.href=n);let l=e.headers["content-type"],v={data:r,maxPage:i,perms:o,modifications:s,custom:u,response:e,success:!0,httpStatus:e.status,autoReloadId:a,contentType:l,validationCode:d,validationMessage:c,validationData:m};return b("Parsed response:",v),this.onSuccess.hasActionDefined()?this.onSuccess.run(v):v}parseError(e){this.fetchStatus.stop();let r=[],i=e.response?.headers["content-type"];return{data:{status:typeof e.response>"u"?500:e.response.status},maxPage:-1,perms:r,modifications:{},custom:{},response:e,success:!1,httpStatus:typeof e.response>"u"?500:e.response.status,autoReloadId:0,contentType:i,validationCode:"",validationMessage:"",validationData:{}}}};var Ue=t=>{let e={...t,method:"get"};return L(e)},Me=t=>{let e={...t,method:"post"};return L(e)},Ie=t=>{let e={...t,method:"put"};return L(e)},Fe=t=>{let e={...t,method:"delete"};return L(e)},Ne=t=>{let e={...t,method:"open"};return L(e)},$e=t=>{let e={...t,method:"download"};return L(e)},L=t=>{let e=new T(t);return g.addResource(e),oe(t.name)},Ge=t=>{let e=new O(t.name,t.url,t.auth,t.params,t.headers);return g.addEnvironment(e),y(t.name)},oe=t=>g.getResource(t),y=t=>g.getEnvironment(t);var le=async(t="",e={})=>{let r=typeof t=="object"?t:oe(t);return typeof r<"u"?await r.call(e):{data:{},maxPage:-1,perms:[],modifications:{},response:void 0,success:!1,httpStatus:-1,autoReloadId:-1,custom:{},contentType:"",validationCode:"",validationMessage:"",validationData:{}}};var se=class{constructor(e){e||(e=""),this.value=e}exists(){return g.hasResource(this.value)}async call(e){return await le(this.value,e)}};var ie=class{constructor(e){e||(e={}),this.value=e}setParam(e,r){this.value[e]=r}getParams(){return this.value}};var pe=class{constructor(e){this.resource=new se(e.resource),this.params=new ie(e.params)}isCallable(){return this.resource.exists()}setParam(e,r){this.params.setParam(e,r)}setParams(e){Object.keys(e).forEach(r=>{this.params.setParam(r,e[r])})}async call(){return this.isCallable()?await this.resource.call(this.params.getParams()):await Be(void 0,void 0)}};var _e={install:(t,e)=>{window.download=ae}},Gr=_e;export{ve as ModificationHandleType,pe as ResourceCaller,be as ResourceMethod,Fe as createHTTPDeleteResource,$e as createHTTPDownloadResource,Ge as createHTTPEnvironment,Ue as createHTTPGetResource,Ne as createHTTPOpenResource,Me as createHTTPPostResource,Ie as createHTTPPutResource,Ae as debugLktHttpClient,Gr as default,we as existsHTTPResource,y as getHTTPEnvironment,oe as getHTTPResource,le as httpCall};
