(function(i,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("axios"),require("lkt-control-tools"),require("lkt-string-tools"),require("lkt-object-tools")):typeof define=="function"&&define.amd?define(["exports","axios","lkt-control-tools","lkt-string-tools","lkt-object-tools"],c):(i=typeof globalThis<"u"?globalThis:i||self,c(i.LktHttpClient={},i.axios,i.LktControlTools,i.LktStringTools,i.LktObjectTools))})(this,function(i,c,f,T,R){"use strict";var ae=Object.defineProperty;var oe=(i,c,f)=>c in i?ae(i,c,{enumerable:!0,configurable:!0,writable:!0,value:f}):i[c]=f;var s=(i,c,f)=>(oe(i,typeof c!="symbol"?c+"":c,f),f);const y=(t=>t&&typeof t=="object"&&"default"in t?t:{default:t})(c);class O{constructor(e){s(this,"value");e||(e=""),this.value=e}}class V{constructor(e){s(this,"value");if(e==="")throw new Error("A resource must have a valid name");this.value=e}}class D{constructor(e,n,r){s(this,"name");s(this,"url");s(this,"auth");this.name=new V(e),this.url=new O(n),this.auth=r}}class U{constructor(){s(this,"value",{})}add(e){this.value[e.name.value]=e}get(e){if(this.value[e]instanceof D)return this.value[e]}exists(e){return this.value[e]instanceof D}}class j{constructor(){s(this,"value",{})}add(e){this.value[e.name.value]=e}get(e){if(this.value[e]instanceof E)return this.value[e]}exists(e){return this.value[e]instanceof E}}class m{constructor(){s(this,"resources");s(this,"environments");this.resources=new j,this.environments=new U}}s(m,"router"),s(m,"DEFAULT_ENVIRONMENT");const _=t=>{const e=[];return Object.keys(t).forEach(r=>{Array.isArray(t[r])?t[r].length>0&&e.push(`${r}=${JSON.stringify(t[r])}`):e.push(`${r}=${t[r]}`)}),e.join("&")},x=t=>v().resources.exists(t),v=()=>(m.router instanceof m||(m.router=new m),m.router);class C{constructor(e){s(this,"value");e||(e="json"),this.value=e}isJSON(){return this.value==="json"}}class F{constructor(e){s(this,"value");e||(e="default"),this.value=e}getUrl(){const e=w(this.value);return e?e.url.value:""}getAuth(){const e=w(this.value);return e&&e.auth?e.auth:{}}}class L{constructor(e){s(this,"value");e||(e=!1),this.value=e}}class M{constructor(e){s(this,"value");e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return R.fetchInObject(e,this.value)}}class ${constructor(e=!1){s(this,"value");this.value=e}inProgress(){return this.value}start(){this.value=!0}stop(){this.value=!1}}class N{constructor(e){s(this,"value");e||(e="get"),this.value=e}toPrimitive(){return this.value.toLowerCase()}isGET(){return this.value==="get"}isPOST(){return this.value==="post"}isPUT(){return this.value==="put"}isDELETE(){return this.value==="delete"}isOPEN(){return this.value==="open"}isDOWNLOAD(){return this.value==="download"}hasUrlParams(){return this.isGET()||this.isOPEN()}}class P{}s(P,"RESOURCE_PARAM_LEFT_SEPARATOR","{"),s(P,"RESOURCE_PARAM_RIGHT_SEPARATOR","}");class I{constructor(e){s(this,"value");e||(e={}),this.value=e}prepareValues(e,n=!1){e||(e={});const r=Object.keys(this.value),a=n?new window.FormData:{};return r.forEach(o=>{const l=this.value[o].default||null;if(e[o]||l){const g=this.value[o].renameTo||null||o;let u=e[o]||l;const d=this.value[o].type||null;if(d&&u!==null&&typeof u!==void 0)if(d==="string"&&typeof u!="string")u=T.toString(u);else if(d==="number"&&typeof u!="number")u=Number(u);else{if(d==="boolean"&&typeof u!="boolean")throw new Error(`Param '${o}' must be of type boolean. '${u}' received`);if(d==="array"&&!Array.isArray(u))throw new Error(`Param '${o}' must be a valid array. '${u}' received`);if(d==="object"&&typeof u!="object")throw new Error(`Param '${o}' must be a valid object. '${u}' received`)}n?a.append(g,u):a[g]=u}}),a}replaceUrlValues(e,n){const r=this.prepareValues(n,!1);return T.fill(e,r,P.RESOURCE_PARAM_LEFT_SEPARATOR,P.RESOURCE_PARAM_RIGHT_SEPARATOR)}}class G{constructor(e){s(this,"value");if(e==="")throw new Error("A resource must have a valid url");this.value=e}prepare(e){return e?`${e}${this.value}`:this.value}}class q{constructor(e){s(this,"value");typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e){return this.value(e)}}class J{constructor(e){s(this,"value");e||(e=!1),this.value=e}}class B{constructor(e){s(this,"value");e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return R.fetchInObject(e,this.value)}}class K{constructor(e){s(this,"value");e||(e=[200,201,202]),this.value=e}includes(e){return this.value.includes(e)}}class W{constructor(e,n,r,a,o,l){s(this,"url");s(this,"method");s(this,"data");s(this,"auth");s(this,"statusValidator");s(this,"headers");this.url=e,this.method=n,this.data=r,this.auth=a,this.statusValidator=o,this.headers=l}}class z{constructor(e){s(this,"value");e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return R.fetchInObject(e,this.value)}}class Q{constructor(e){s(this,"value");e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return R.fetchInObject(e,this.value)}}class E{constructor(e){s(this,"data");s(this,"url");s(this,"name");s(this,"method");s(this,"environment");s(this,"dataType");s(this,"params");s(this,"isFileUpload");s(this,"validStatuses");s(this,"fetchStatus");s(this,"onSuccess");s(this,"returnsFullResponse");s(this,"returnsResponseDig");s(this,"maxPageDig");s(this,"permDig");s(this,"modificationsDig");this.data=e,this.url=new G(e.url),this.name=new V(e.name),this.method=new N(e.method),this.environment=new F(e.environment),this.dataType=new C(e.dataType),this.params=new I(e.params),this.isFileUpload=new L(e.isFileUpload),this.validStatuses=new K(e.validStatuses),this.fetchStatus=new $,this.onSuccess=new q(e.onSuccess),this.returnsFullResponse=new J(e.returnsFullResponse),this.returnsResponseDig=new B(e.digToData),this.maxPageDig=new M(e.digToMaxPage),this.permDig=new z(e.digToPerms),this.modificationsDig=new Q(e.digToModifications)}build(e){let n=this.params.prepareValues(e,this.isFileUpload.value);const r=this.url.prepare(this.environment.getUrl());let a=this.params.replaceUrlValues(r,e);if(this.method.hasUrlParams()){const h=_(n);h.length>0&&(a=[a,h].join("?")),n={}}const o=h=>this.validStatuses.includes(h);let l;return this.isFileUpload.value&&(l={"Content-Type":"multipart/form-data"}),new W(a,this.method.toPrimitive(),n,this.environment.getAuth(),o,l)}async call(e){const n=this.build(e);if(this.fetchStatus.inProgress())return f.successPromise();switch(n.method){case"get":case"post":case"put":case"delete":return this.fetchStatus.start(),await y.default(n).then(r=>{this.fetchStatus.stop();let a=this.returnsFullResponse.value?r:r.data,o=-1;this.maxPageDig.hasToDig()&&(o=this.maxPageDig.dig(a));let l;this.permDig.hasToDig()&&(l=this.permDig.dig(a));let h={};this.modificationsDig.hasToDig()&&(h=this.modificationsDig.dig(a)),this.returnsResponseDig.hasToDig()&&(a=this.returnsResponseDig.dig(a));const g={data:a,maxPage:o,perms:l,modifications:h,response:r};return this.onSuccess.hasActionDefined()?this.onSuccess.run(g):g}).catch(r=>(this.fetchStatus.stop(),Promise.reject(new Error(r))));case"download":case"open":return y.default.get(n.url,{responseType:"blob"}).then(r=>{const a=r.headers["content-disposition"];let o="";a&&a.split(";").forEach(u=>{const d=u.split("=");if(T.trim(d[0])==="filename"){let S=T.trim(d[1]);S=T.trim(S,'"'),o=S}}),window.download(r.data,o);let l=[];const h={data:r.data,maxPage:0,perms:l,modifications:{},response:r};return this.onSuccess.hasActionDefined()?this.onSuccess.run(h):r}).catch(r=>r);default:throw new Error(`Error: Invalid method in call ${JSON.stringify(n)}`)}}}const X=t=>{const e={...t,method:"get"};return p(e)},Y=t=>{const e={...t,method:"post"};return p(e)},Z=t=>{const e={...t,method:"put"};return p(e)},k=t=>{const e={...t,method:"delete"};return p(e)},ee=t=>{const e={...t,method:"open"};return p(e)},te=t=>{const e={...t,method:"download"};return p(e)},p=t=>{const e=new E(t);return v().resources.add(e),A(t.name)},b=t=>{const e=new D(t.name,t.url,t.auth);return v().environments.add(e),w(t.name)},A=t=>v().resources.get(t),w=t=>v().environments.get(t),H=async(t="",e={})=>await A(t).call(e);class se{constructor(e){s(this,"value");e||(e=""),this.value=e}exists(){return v().resources.exists(this.value)}async call(e){return await H(this.value,e)}}class re{constructor(e){s(this,"value");e||(e={}),this.value=e}setParam(e,n){this.value[e]=n}getParams(){return this.value}}class ie{constructor(e){s(this,"resource");s(this,"params");this.resource=new se(e.resource),this.params=new re(e.params)}isCallable(){return this.resource.exists()}setParam(e,n){this.params.setParam(e,n)}setParams(e){Object.keys(e).forEach(n=>{this.params.setParam(n,e[n])})}async call(){return this.isCallable()?await this.resource.call(this.params.getParams()):await f.successPromise()}}const ne={install:(t,e)=>{b({name:"default",url:""}),window.download=require("downloadjs")}};i.ResourceCaller=ie,i.createHTTPDeleteResource=k,i.createHTTPDownloadResource=te,i.createHTTPEnvironment=b,i.createHTTPGetResource=X,i.createHTTPOpenResource=ee,i.createHTTPPostResource=Y,i.createHTTPPutResource=Z,i.default=ne,i.existsHTTPResource=x,i.getHTTPEnvironment=w,i.getHTTPResource=A,i.getRouter=v,i.httpCall=H,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
